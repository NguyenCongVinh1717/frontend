<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang Sinh viên</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f5f8fc;
      color: #1e293b;
      min-height: 100vh;
    }

    /* HEADER */
    header {
      background-color: #e9f1fb;
      border-bottom: 1px solid #d3e0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px 0;
      position: relative;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      height: 120px;
    }
    header img {
      position: absolute;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      height: 100px;
      width: 100px;
    }
    header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #1a2a5b;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      text-align: center;
      padding: 0 40px;
    }

    /* SIDEBAR */
    .sidebar {
      width: 260px;
      background-color: #0b2347;
      color: #fff;
      padding: 24px 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: fixed;
      left: 0;
      top: 120px;
      bottom: 56px;
      overflow-y: auto;
    }

    .sidebar h2 {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      color: #a8c6ff;
      margin-bottom: 8px;
      padding-bottom: 6px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      padding: 10px 12px;
      border-radius: 6px;
      transition: all 0.15s ease;
    }

    .sidebar a i {
      font-size: 18px;
      width: 22px;
      text-align: center;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background-color: #1e3a8a;
    }

    /* MAIN WRAPPER */
    .main-wrap {
      margin-left: 260px;
      padding: 28px 32px;
      min-height: calc(100vh - 120px - 56px);
    }

    .content-area {
      max-width: 1300px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 22px;
      align-items: start;
    }

    .content-box {
      background: #fff;
      border-radius: 10px;
      padding: 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      border: 1px solid #e3eaf2;
    }

    .content-box h2 {
      font-size: 20px;
      color: #1a2a5b;
      margin-bottom: 14px;
      text-align: center;
    }

    .profile-list { list-style: none; }
    .profile-list li { padding: 12px 6px; border-bottom: 1px dashed #eef2ff; display:flex; justify-content:space-between; }
    .profile-list li strong { color: #2563eb; }

    #enrollmentCards { display:flex; flex-wrap:wrap; gap:12px; }
    .enroll-card {
      background: #fff;
      border: 1px solid #e6eefc;
      border-radius: 8px;
      padding: 12px;
      min-width: 220px;
      flex: 1 1 220px;
    }
    .enroll-card h6 { margin: 0 0 6px 0; color: #2563eb; font-size: 15px; }
    .enroll-card p { margin: 6px 0; color: #1e293b; display:flex; justify-content:space-between; }

    /* SCHEDULE — enlarged layout */
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 30px;
    }
    .day-column {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      padding: 22px;
      min-height: 350px;
      border: 1px solid #e5eaf2;
      transition: transform 0.2s ease;
    }
    .day-column:hover {
      transform: translateY(-4px);
    }
    .day-column h6 {
      text-align: center;
      border-bottom: 3px solid #e2e8f0;
      color: #2563eb;
      font-size: 18px;
      font-weight: 600;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    .class-item {
      background: #eef4ff;
      border-left: 6px solid #2563eb;
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 14px;
      font-size: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .class-item strong {
      display: block;
      color: #1e3a8a;
      font-size: 16px;
      margin-bottom: 3px;
    }

    .password-card input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #d1d5db; }
    .password-card button { padding: 10px 12px; border-radius: 6px; border: none; background: #1e3a8a; color: #fff; cursor: pointer; font-weight: 600; }

    footer {
      background-color: #e9f1fb;
      border-top: 1px solid #d3e0f0;
      text-align: center;
      padding: 10px 0;
      color: #1a2a5b;
      font-weight: 500;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <header>
    <img src="anh/Thiết kế chưa có tên.png" alt="Logo hệ thống">
    <h1>HỆ THỐNG QUẢN LÝ HỌC SINH VÀ GIÁO VIÊN TRƯỜNG TIỂU HỌC CHU MINH</h1>
  </header>

  <aside class="sidebar">
    <h2>BẢNG ĐIỀU KHIỂN</h2>
    <a href="#" class="active" onclick="toggleSection('profileSection', event)"><i class="bi bi-person-circle"></i> Thông tin cá nhân</a>
    <a href="#" onclick="toggleSection('enrollmentSection', event)"><i class="bi bi-book"></i> Môn học đã đăng ký</a>
    <a href="#" onclick="toggleSection('scheduleSection', event)"><i class="bi bi-calendar-week"></i> Thời khóa biểu</a>
    <a href="#" onclick="toggleSection('passwordSection', event)"><i class="bi bi-lock"></i> Đổi mật khẩu</a>
  </aside>

  <div class="main-wrap">
    <div class="content-area">
      <div>
        <section id="profileSection" class="content-box">
          <h2>Thông tin cá nhân</h2>
          <ul class="profile-list">
            <li><strong>Mã SV:</strong><span id="code"></span></li>
            <li><strong>Họ tên:</strong><span id="fullName"></span></li>
            <li><strong>Lớp:</strong><span id="className"></span></li>
            <li><strong>Email:</strong><span id="email"></span></li>
          </ul>
        </section>

        <section id="enrollmentSection" class="content-box" style="display:none;">
          <h2>Môn học đã đăng ký</h2>
          <div id="enrollmentCards"></div>
        </section>

        <!-- SCHEDULE - enlarged -->
        <section id="scheduleSection" class="content-box" style="display:none;">
          <h2>Thời khóa biểu</h2>
          <div class="schedule-grid" id="scheduleGrid"></div>
        </section>
      </div>

      <aside class="right-column">
        <div class="content-box password-card" id="passwordSection" style="display:none;">
          <h2 style="font-size:16px; margin-bottom:10px;">Đổi mật khẩu</h2>
          <input type="password" id="oldPassword" placeholder="Mật khẩu cũ">
          <input type="password" id="newPassword" placeholder="Mật khẩu mới">
          <input type="password" id="confirmPassword" placeholder="Xác nhận mật khẩu mới">
          <button onclick="changePassword()">Xác nhận</button>
        </div>
      </aside>
    </div>
  </div>

  <footer>© 2025 Hệ thống quản lý học sinh và giáo viên - Nhóm 3</footer>

  <script src="api.js"></script>
  <script>
    const studentId = localStorage.getItem('studentId');
    let classId;

    window.onload = async function() {
      if(!studentId){ alert("Vui lòng đăng nhập lại!"); window.location.href="login.html"; return; }
      await loadProfile();
      await loadEnrollments();
      await loadSchedule();
    };

    async function loadProfile(){
      try{
        const p = await apiGet(`/student/${studentId}`);
        document.getElementById('code').textContent = p.studentCode;
        document.getElementById('fullName').textContent = p.fullName;
        document.getElementById('className').textContent = p.className;
        document.getElementById('email').textContent = p.email;
        classId = p.classId;
      }catch(e){ alert('Không tải được thông tin sinh viên: '+e.message); }
    }

    async function loadEnrollments(){
      try{
        const list = await apiGet(`/student/${studentId}/enrollments`);
        const container = document.getElementById('enrollmentCards');
        container.innerHTML = list.map(e => `
          <div class="enroll-card">
            <h6><i class="bi bi-book"></i> ${e.subjectName}</h6>
            <p><span>Giáo viên:</span> <span>${e.teacherName}</span></p>
            <p><span>Điểm:</span> <span>${e.grade ?? '-'}</span></p>
          </div>
        `).join('');
      }catch(e){ console.error(e); }
    }

    async function loadSchedule(){
      if(!classId) return;
      try{
        const list = await apiGet(`/student/students/${classId}/schedules`);
        const days = [
          { name: "Thứ 2", code: 2 },
          { name: "Thứ 3", code: 3 },
          { name: "Thứ 4", code: 4 },
          { name: "Thứ 5", code: 5 },
          { name: "Thứ 6", code: 6 },
          { name: "Thứ 7", code: 7 },
          { name: "Chủ nhật", code: 1 }
        ];
        const container = document.getElementById('scheduleGrid');
        container.innerHTML = days.map(day => {
          const subjects = list.filter(s => s.dayOfWeek === day.code);
          return `
            <div class="day-column">
              <h6>${day.name}</h6>
              ${
                subjects.length
                  ? subjects.map(s => `
                      <div class="class-item">
                        <strong>${s.subjectName}</strong>
                        GV: ${s.teacherName}<br>
                        Tiết: ${s.period}
                      </div>
                    `).join('')
                  : `<p style="text-align:center;color:#888;">Không có tiết</p>`
              }
            </div>
          `;
        }).join('');
      }catch(e){ console.error(e); }
    }

    async function changePassword(){
      const oldPass = document.getElementById('oldPassword').value.trim();
      const newPass = document.getElementById('newPassword').value.trim();
      const confirmPass = document.getElementById('confirmPassword').value.trim();
      if(newPass !== confirmPass) return alert('Mật khẩu xác nhận không khớp!');
      if(!oldPass || !newPass) return alert('Vui lòng nhập đầy đủ!');
      try{
        await apiPost('/student/change-password',{oldPassword:oldPass,newPassword:newPass});
        alert('Đổi mật khẩu thành công!');
        document.getElementById('oldPassword').value = '';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';
      }catch(e){ alert('Lỗi: '+e.message); }
    }

    function toggleSection(id, event){
      ['profileSection','enrollmentSection','scheduleSection','passwordSection'].forEach(sid => {
        const el = document.getElementById(sid);
        if(el) el.style.display = 'none';
      });
      const show = document.getElementById(id);
      if(show) show.style.display = 'block';

      document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
      const target = event.target.closest('a') || event.target;
      if(target) target.classList.add('active');
    }
  </script>
</body>
</html>
